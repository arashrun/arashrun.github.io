---
title: 交叉编译
date: 2025-06-12 14:34:09
categories:
  - c++
tags:
  - qemu
---


### 方式一

> 交叉编译器 + 源码

优点：
- 精准的版本控制
- 适配范围广，无需重复工作

缺点：
- 复杂，需要解决各种编译问题
- 依赖过多的情况下工作量大

对于像qt这样构建依赖很多的库不是很方便。对于这些构建依赖，最好的办法是能有一个目标架构的根文件系统

### 方式二

> 交叉编译器 + 目标架构根文件系统(方便包管理工具安装构建依赖) + 源码

采用qemu和根文件系统的方式进行快速适配。适用于提供了文件系统镜像的情况下。

1. 挂载镜像
2. chroot进入镜像安装编译环境

```bash

sudo apt install qemu-user-static

update-binfmts --display

echo ':aarch64:M::\x7fELF\x02\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\xb7\x00:\xff\xff\xff\xff\xff\xff\xff\x00\xff\xff\xff\xff\xff\xff\xff\xff\xfe\xff\xff\xff:/usr/bin/qemu-aarch64-static:' | sudo tee /proc/sys/fs/binfmt_misc/register


sudo mount --bind /dev /mnt/uos/dev
sudo mount --bind /dev/pts /mnt/uos/dev/pts
sudo mount --bind /proc /mnt/uos/proc
sudo mount --bind /sys /mnt/uos/sys

sudo chroot /mnt/uos

sudo umount /mnt/uos/sys
sudo umount /mnt/uos/proc
sudo umount /mnt/uos/dev/pts
sudo umount /mnt/uos/dev


# 镜像空间扩容，解决apt安装空间不足问题

resize2fs 0925_RK_test_rootfs.img 6G

# 设置 locales（语言环境）
apt install locales dialog 
dpkg-reconfigure locales

```


### 方式三

> 目标架构根文件系统(提供：编译器+依赖) + 源码

缺点：
- 指令转译导致构建速度慢
- 目标根文件系统不一定容易获取到



## Qt编译


**方式3** 的编译配置命令（直接编译）

```bash
rm config.cache
../qt-everywhere-src-5.12.8/configure -release -opensource -confirm-license 
-qt-xcb 
-nomake examples 
-nomake tests 
-nomake tools 
-skip qtwebengine 
-skip qtimageformats 
-skip qtdeclarative 
-skip qtgraphicaleffects 
-skip qtlocation 
-skip qtsensors 
-skip qtwayland 
-skip qtwebchannel 
-skip qtwebsockets 
-skip qtgamepad 
-skip qtquickcontrols 
-skip qtquickcontrols2 
-skip qtscxml 
-skip qtcharts 
-skip qtdatavis3d 
-skip qtvirtualkeyboard 
-skip qtserialbus 
-skip qtremoteobjects 
-skip qttools 
-skip qt3d 
-skip qtconnectivity 
-skip qtpurchasing 
-qt-zlib -qt-pcre -qt-libpng -qt-libjpeg 
-prefix /opt/qt5 
-recheck-all 
-v
```

`-skip xxx` : 跳过模块，模块名称对应qt源码根目录下的模块一级目录名称
`-qt-xxx` : 使用qt源码内置的三方库，不依赖系统的
`-v` : 详细输出，方便查看配置过程的问题


**方式1，2** 编译配置指令（交叉编译）

```bash

```

`-platform` : 编译平台架构配置
`-xplatform` : 交叉编译需要指定的目标平台选项
`-device` : 特定设备或芯片集。这个更多面向嵌入式设备，不是常规Linux
`-device-option` : 


**编译问题解决**

- 未生成需要的qt模块
- 生成的qt模块但是功能有缺失（如无法显示字体）


```
# 上述问题一般都是缺少编译依赖导致的，通过分析 
config.opt / config.summary 
来排查依赖缺失导致的编译问题
```


**单独编译qt某个模块** 

当明确知道缺少哪个模块的时候，重复执行配置等操作很耗时。可以指定单独编译某个模块

```
make -j4 module-qtserialport
```

模块名称就是qt源码根目录下的目录名称，前面再加上module即可







#### 参考


[使用debootstrap构建制作aarch64/arm64 Debian rootfs文件系统-阿里云开发者社区](https://developer.aliyun.com/article/1172718)
[Building Qt 5 from Git - Qt Wiki](https://wiki.qt.io/Building_Qt_5_from_Git#Getting_the_source_code)
[Qt Configure Options | Qt 5.15](https://qthub.com/static/doc/qt5/qtdoc/configure-options.html)