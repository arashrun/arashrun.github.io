---
title: 设计模式
date: 2025-02-27 17:04:57
categories:
  - cs基础
tags:
  - 设计模式
---

## qt中的设计模式


Qt 框架广泛使用了各种设计模式，以实现其灵活性、可扩展性和可维护性。以下是 Qt 中用到的一些主要设计模式：

**1. 对象创建型模式 (Creational Patterns)**

*   **工厂方法模式 (Factory Method):**
    *   `Q_DECLARE_METATYPE` 和 `qRegisterMetaType` 宏以及相关的 `QMetaType` 系统，允许创建未知类型的对象（在运行时确定类型）。
    *   `QPluginLoader` 使用工厂方法来加载和创建插件对象。

*   **抽象工厂模式 (Abstract Factory):**
    *   `QStyle` 类及其子类（如 `QWindowsStyle`, `QMacStyle`）提供了一个抽象工厂，用于创建与平台相关的 UI 元素外观（按钮、滚动条等）。

*   **单例模式 (Singleton):**
    *   `QApplication` 类（通常通过全局的 `qApp` 指针访问）是一个单例，代表整个应用程序。
    *   `QCoreApplication::instance()` 也是一个单例。
*  **原型模式 (Prototype)**
    *   `QObject::clone()` 可以创建一个新的对象，它是现有对象的副本。虽然Qt中不直接叫`clone()`, 但是`Q_DECLARE_COPY`以及相关拷贝构造函数均可以看作是原型模式的应用.

**2. 结构型模式 (Structural Patterns)**

*   **适配器模式 (Adapter):**
    *   `QAbstractItemModel` 为各种不同的数据源（列表、树、表格等）提供了一个统一的接口，使它们可以与 `QListView`、`QTreeView`、`QTableView` 等视图组件一起使用。
    *   信号和槽机制，在某种程度上也可以看作是适配器模式的一种体现，但主要还是观察者模式。它将信号的发送者和槽的接收者解耦，信号可以看作是一个“适配器”，将发送者的动作转换为接收者可以理解的调用。

*   **组合模式 (Composite):**
    *   Qt 的部件（Widget）层次结构是组合模式的典型应用。`QWidget` 可以包含其他 `QWidget`（作为子部件），形成一个树形结构。

*   **装饰器模式 (Decorator):**
    *   `QLayout` 可以用来动态地向部件添加布局管理，而无需修改部件本身。
    * `QGraphicsEffect`类及其子类（如`QGraphicsBlurEffect`）可以为`QGraphicsItem`添加额外的视觉效果。

*   **外观模式 (Facade):**
    *   `QNetworkAccessManager` 为网络请求（HTTP, FTP 等）提供了一个更高层次、更易于使用的接口，隐藏了底层的复杂性。

*   **代理模式 (Proxy):**
    *   `QSortFilterProxyModel` 可以在不修改原始数据模型的情况下，对数据进行排序和过滤，然后将结果呈现给视图。
    *   `QIdentityProxyModel`将源模型数据直接传递给视图，不做任何修改，这也可以看作是代理模式最简单的形式。

**3. 行为型模式 (Behavioral Patterns)**

*   **观察者模式 (Observer):**
    *   Qt 的信号和槽机制是观察者模式的经典实现。一个对象（信号发送者）的状态变化会通知其他对象（槽接收者）。

*   **策略模式 (Strategy):**
    *   `QAbstractButton` 的不同子类（`QPushButton`, `QCheckBox`, `QRadioButton`）实现了不同的按钮行为。
    *   `QTextCodec`及其子类(`QTextCodec::codecForName("UTF-8")`)为文本编码和解码提供了不同的策略。

*   **模板方法模式 (Template Method):**
    *   许多 Qt 类都定义了虚拟函数，允许子类重写这些函数以自定义行为，而无需改变类的整体结构。例如，`QWidget::paintEvent`、`QWidget::mousePressEvent` 等事件处理函数。
    *   `QAbstractItemModel` 也定义了一系列虚函数, 子类必须实现这些函数以提供特定的数据访问方式.

*   **迭代器模式 (Iterator):**
    *   Qt 提供了各种迭代器类，如 `QListIterator`, `QMapIterator`, `QHashIterator` 等，用于遍历容器中的元素。

*   **状态模式 (State):**
     *  `QStateMachine` 类允许对象根据其内部状态改变其行为, 内部使用了状态模式.
     *   `QAbstractAnimation`及其子类(`QPropertyAnimation`)也可以看作是状态模式的一种应用.

*   **命令模式 (Command):**
    *   `QUndoCommand` 类表示一个可以执行和撤销的操作，常用于实现撤销/重做功能。

**其他一些模式:**

*   **中介者模式 (Mediator):**
    *   `QDialog` 可以作为多个部件之间的中介者，协调它们之间的交互。

*   **备忘录模式 (Memento):**
    *   `QUndoStack`使用`QUndoCommand`类来实现了撤销/重做功能,其中用到了备忘录模式.

**总结:**

这只是 Qt 框架中使用的一些主要设计模式。Qt 的设计非常灵活和强大，很多地方都体现了设计模式的思想。理解这些设计模式有助于更好地理解 Qt 的工作原理，并编写出更优雅、可维护的 Qt 代码。 并非所有的 Qt 类都严格遵循某一种设计模式，有些类的设计可能融合了多种模式的思想。